<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Browse current funding opportunities for research at KEMRI">
    <meta name="keywords" content="KEMRI, Grant Management, Research Funding, Opportunities, Grants">
    <meta name="author" content="Kenya Medical Research Institute">
    <meta name="robots" content="index, follow">
    
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="assets/images/kemrilogo.png">
    
    <title>Funding Opportunities | KEMRI Grant Management Department</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="assets/js/main.js" defer></script>
    
    <style>
        /* Funding page specific styles */
        .filter-panel {
            background: #f5f5f5;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .funding-card {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: transform 0.2s;
        }
        
        .funding-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .funding-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .funding-title {
            margin: 0 0 0.5rem 0;
            color: #0056b3;
        }
        
        .funding-funder {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .funding-deadline {
            background: #0056b3;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 500;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .funding-deadline.urgent {
            background: #dc3545;
        }
        
        .funding-content {
            margin-bottom: 1rem;
        }
        
        .funding-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .funding-meta-item {
            display: flex;
            align-items: center;
        }
        
        .funding-meta-item i {
            margin-right: 0.5rem;
            color: #0056b3;
        }
        
        .funding-description {
            margin-bottom: 1rem;
        }
        
        .funding-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .funding-tag {
            background: #e9f0f8;
            color: #0056b3;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .funding-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .funding-actions .btn {
            padding: 0.5rem 1.2rem;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .pagination-item {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 4px;
            background: #f5f5f5;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .pagination-item:hover,
        .pagination-item.active {
            background: #0056b3;
            color: white;
        }
        
        .search-results-info {
            margin-bottom: 1.5rem;
            font-style: italic;
            color: #666;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .funding-header {
                flex-direction: column;
            }
            
            .funding-deadline {
                margin-top: 1rem;
                align-self: flex-start;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header role="banner">
        <div class="container">
            <div class="logo-container">
                <a href="https://www.kemri.org/" target="_blank" rel="noopener noreferrer">
                    <img src="assets/images/kemrilogo.png" alt="KEMRI Logo" class="logo">
                </a>
                <div class="logo-text">
                    <h1>KEMRI</h1>
                    <p>Grant Management Department</p>
                </div>
            </div>
            <nav role="navigation" aria-label="Main Navigation">
                <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <ul class="nav-menu" id="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="organization.html">Organizational Structure</a></li>
                    <li><a href="units.html">Department Units</a></li>
                    <li><a href="resources.html">Resources</a></li>
                    <li class="active"><a href="funding.html">Funding Opportunities</a></li>
                    <li><a href="news.html">News & Opportunities</a></li>
                    <li><a href="contact.html">Contact Us</a></li>
                    <li class="search-nav">
                        <form action="search.html" method="get" role="search" class="header-search">
                            <input type="search" name="q" id="search-input-nav" placeholder="Search..." aria-label="Search website">
                            <button type="submit" aria-label="Submit search"><i class="fas fa-search"></i></button>
                        </form>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="breadcrumbs" role="navigation" aria-label="Breadcrumb">
        <div class="container">
            <ol>
                <li><a href="index.html">Home</a></li>
                <li aria-current="page">Funding Opportunities</li>
            </ol>
        </div>
    </div>

    <main id="main-content" role="main">
        <section class="page-header">
            <div class="container">
                <h2>Funding Opportunities</h2>
                <p>Browse current funding opportunities for health research in Kenya and internationally</p>
            </div>
        </section>

        <section class="funding-database">
            <div class="container">
                <div class="filter-panel">
                    <h3>Find Funding Opportunities</h3>
                    
                    <div class="search-box">
                        <input type="text" id="search-funding" placeholder="Search by keyword, funder, or research area..." aria-label="Search funding opportunities">
                        <button type="button" class="btn btn-primary" onclick="searchFunding()">Search</button>
                    </div>
                    
                    <h4>Filter Options</h4>
                    
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="research-area">Research Area</label>
                            <select id="research-area">
                                <option value="">All Research Areas</option>
                                <option value="infectious-diseases">Infectious Diseases</option>
                                <option value="non-communicable-diseases">Non-Communicable Diseases</option>
                                <option value="maternal-health">Maternal and Child Health</option>
                                <option value="public-health">Public Health</option>
                                <option value="clinical-research">Clinical Research</option>
                                <option value="biomedical-sciences">Biomedical Sciences</option>
                                <option value="implementation-science">Implementation Science</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="funder-type">Funder Type</label>
                            <select id="funder-type">
                                <option value="">All Funders</option>
                                <option value="government">Government</option>
                                <option value="foundation">Foundation</option>
                                <option value="international">International Organization</option>
                                <option value="corporate">Corporate</option>
                                <option value="academic">Academic Institution</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="funding-amount">Funding Amount (USD)</label>
                            <select id="funding-amount">
                                <option value="">Any Amount</option>
                                <option value="small">Up to $50,000</option>
                                <option value="medium">$50,000 - $250,000</option>
                                <option value="large">$250,000 - $1 million</option>
                                <option value="very-large">Over $1 million</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="deadline">Deadline</label>
                            <select id="deadline">
                                <option value="">Any Deadline</option>
                                <option value="upcoming">Upcoming (Next 30 days)</option>
                                <option value="urgent">Urgent (Next 7 days)</option>
                                <option value="future">Future (Over 30 days)</option>
                                <option value="rolling">Rolling (No fixed deadline)</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="eligibility">Eligibility</label>
                            <select id="eligibility">
                                <option value="">All Types</option>
                                <option value="early-career">Early Career Researchers</option>
                                <option value="established">Established Researchers</option>
                                <option value="institutional">Institutional</option>
                                <option value="collaborative">Collaborative</option>
                                <option value="international">International Collaboration</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="sort-by">Sort By</label>
                            <select id="sort-by">
                                <option value="deadline-asc">Deadline (Soonest first)</option>
                                <option value="deadline-desc">Deadline (Latest first)</option>
                                <option value="amount-asc">Funding Amount (Low to High)</option>
                                <option value="amount-desc">Funding Amount (High to Low)</option>
                                <option value="posted-desc">Recently Posted</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-actions">
                        <button type="button" class="btn btn-secondary" onclick="resetFilters()">Reset Filters</button>
                        <button type="button" class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                    </div>
                </div>
                
                <div class="search-results-info">
                    Showing <span id="result-count">3</span> funding opportunities
                </div>
                
                <div class="funding-list">
                    <!-- Sample funding opportunities -->
                    <div class="funding-card">
                        <div class="funding-header">
                            <div>
                                <h3 class="funding-title">Global Health Research Fellowship</h3>
                                <p class="funding-funder">Wellcome Trust</p>
                            </div>
                            <div class="funding-deadline">Deadline: 15 Aug 2023</div>
                        </div>
                        
                        <div class="funding-content">
                            <div class="funding-meta">
                                <div class="funding-meta-item">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>£300,000 - £500,000</span>
                                </div>
                                <div class="funding-meta-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>3-5 years</span>
                                </div>
                                <div class="funding-meta-item">
                                    <i class="fas fa-user-graduate"></i>
                                    <span>Early Career Researchers</span>
                                </div>
                            </div>
                            
                            <div class="funding-description">
                                <p>This fellowship offers a unique opportunity for early career researchers from low- and middle-income countries to develop their research capabilities through a tailored career development programme and gain research experience and high-quality mentorship at institutions in the UK and abroad.</p>
                            </div>
                            
                            <div class="funding-tags">
                                <span class="funding-tag">Infectious Diseases</span>
                                <span class="funding-tag">Public Health</span>
                                <span class="funding-tag">Clinical Research</span>
                            </div>
                            
                            <div class="funding-actions">
                                <a href="#" class="btn btn-primary">View Details</a>
                                <button class="btn btn-secondary" onclick="saveOpportunity('1')">
                                    <i class="far fa-bookmark"></i> Save
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="funding-card">
                        <div class="funding-header">
                            <div>
                                <h3 class="funding-title">Implementation Science for Maternal Health</h3>
                                <p class="funding-funder">Bill & Melinda Gates Foundation</p>
                            </div>
                            <div class="funding-deadline urgent">Deadline: 30 Jul 2023</div>
                        </div>
                        
                        <div class="funding-content">
                            <div class="funding-meta">
                                <div class="funding-meta-item">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>$100,000 - $250,000</span>
                                </div>
                                <div class="funding-meta-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>1-3 years</span>
                                </div>
                                <div class="funding-meta-item">
                                    <i class="fas fa-user-graduate"></i>
                                    <span>Institutional</span>
                                </div>
                            </div>
                            
                            <div class="funding-description">
                                <p>This funding opportunity seeks innovative approaches to improve the implementation of evidence-based interventions in maternal health across sub-Saharan Africa, with a particular focus on reducing maternal mortality and improving access to quality care.</p>
                            </div>
                            
                            <div class="funding-tags">
                                <span class="funding-tag">Maternal Health</span>
                                <span class="funding-tag">Implementation Science</span>
                                <span class="funding-tag">Public Health</span>
                            </div>
                            
                            <div class="funding-actions">
                                <a href="#" class="btn btn-primary">View Details</a>
                                <button class="btn btn-secondary" onclick="saveOpportunity('2')">
                                    <i class="far fa-bookmark"></i> Save
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="funding-card">
                        <div class="funding-header">
                            <div>
                                <h3 class="funding-title">Neglected Tropical Diseases Research Grant</h3>
                                <p class="funding-funder">World Health Organization (WHO)</p>
                            </div>
                            <div class="funding-deadline">Deadline: 15 Sep 2023</div>
                        </div>
                        
                        <div class="funding-content">
                            <div class="funding-meta">
                                <div class="funding-meta-item">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>$50,000 - $100,000</span>
                                </div>
                                <div class="funding-meta-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>1-2 years</span>
                                </div>
                                <div class="funding-meta-item">
                                    <i class="fas fa-user-graduate"></i>
                                    <span>Collaborative</span>
                                </div>
                            </div>
                            
                            <div class="funding-description">
                                <p>This grant supports research on neglected tropical diseases prevalent in Africa, with an emphasis on developing new diagnostics, treatments, or prevention strategies. Collaborative proposals involving multiple institutions are particularly encouraged.</p>
                            </div>
                            
                            <div class="funding-tags">
                                <span class="funding-tag">Infectious Diseases</span>
                                <span class="funding-tag">Neglected Tropical Diseases</span>
                                <span class="funding-tag">Biomedical Sciences</span>
                            </div>
                            
                            <div class="funding-actions">
                                <a href="#" class="btn btn-primary">View Details</a>
                                <button class="btn btn-secondary" onclick="saveOpportunity('3')">
                                    <i class="far fa-bookmark"></i> Save
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="pagination">
                    <a href="#" class="pagination-item active">1</a>
                    <a href="#" class="pagination-item">2</a>
                    <a href="#" class="pagination-item">3</a>
                    <a href="#" class="pagination-item">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </div>
            </div>
        </section>
        
        <section class="funding-resources">
            <div class="container">
                <h2>Funding Resources</h2>
                <p>Tools and resources to help you find and apply for funding opportunities</p>
                
                <div class="resource-grid">
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="resource-details">
                            <h3>Funding Alerts</h3>
                            <p>Subscribe to receive notifications when new funding opportunities matching your research interests are added.</p>
                            <a href="#" class="resource-link">Subscribe to Alerts</a>
                        </div>
                    </div>
                    
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="resource-details">
                            <h3>Funding Calendar</h3>
                            <p>View a calendar of upcoming funding deadlines to plan your applications in advance.</p>
                            <a href="#" class="resource-link">View Calendar</a>
                        </div>
                    </div>
                    
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="resource-details">
                            <h3>Application Tips</h3>
                            <p>Access guidance on preparing strong applications for different types of funding opportunities.</p>
                            <a href="#" class="resource-link">Read Tips</a>
                        </div>
                    </div>
                    
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="resource-details">
                            <h3>Funding Support</h3>
                            <p>Contact the Grant Management Department for personalized assistance with identifying and applying for funding.</p>
                            <a href="contact.html" class="resource-link">Request Support</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <a href="https://www.kemri.org/" target="_blank" rel="noopener noreferrer">
                        <img src="assets/images/kemrilogo.png" alt="KEMRI Logo" class="logo">
                    </a>
                    <p>Kenya Medical Research Institute</p>
                    <p>Grant Management Department</p>
                </div>
                <div class="footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="organization.html">Organizational Structure</a></li>
                        <li><a href="units.html">Department Units</a></li>
                        <li><a href="resources.html">Resources</a></li>
                        <li><a href="funding.html">Funding Opportunities</a></li>
                        <li><a href="news.html">News & Opportunities</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="sitemap.html">Sitemap</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h3>Contact Information</h3>
                    <p><strong>Address:</strong> P.O. Box 54840-00200, Nairobi, Kenya</p>
                    <p><strong>Phone:</strong> +254 20 2722541</p>
                    <p><strong>Email:</strong> gmd@kemri.org</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Kenya Medical Research Institute. All Rights Reserved.</p>
                <div class="language-selector">
                    <label for="language-select">Language:</label>
                    <select id="language-select" aria-label="Select language">
                        <option value="en" selected>English</option>
                        <option value="sw">Swahili</option>
                    </select>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Cookie Consent Banner -->
    <div id="cookie-consent" class="cookie-consent" role="alert" aria-live="polite">
        <div class="cookie-content">
            <p>We use cookies to improve your experience on our website. By continuing to browse, you agree to our <a href="privacy-policy.html">Privacy Policy</a>.</p>
            <div class="cookie-buttons">
                <button id="cookie-accept" class="btn btn-sm btn-primary">Accept</button>
                <button id="cookie-decline" class="btn btn-sm btn-secondary">Decline</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch all funding opportunities on page load
            fetchFundingOpportunities();
            
            // Set up event listeners
            document.getElementById('search-funding').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchFunding();
                }
            });
        });
        
        // Function to fetch funding opportunities with optional filters
        async function fetchFundingOpportunities(filters = {}) {
            try {
                // Build query parameters
                const queryParams = new URLSearchParams();
                
                if (filters.searchTerm) {
                    return searchFunding(filters.searchTerm);
                }
                
                if (filters.researchArea) {
                    queryParams.append('researchArea', filters.researchArea);
                }
                
                if (filters.funder) {
                    queryParams.append('funder', filters.funder);
                }
                
                if (filters.minFunding) {
                    queryParams.append('minFunding', filters.minFunding);
                }
                
                if (filters.maxFunding) {
                    queryParams.append('maxFunding', filters.maxFunding);
                }
                
                if (filters.upcoming) {
                    queryParams.append('upcoming', 'true');
                }
                
                if (filters.isActive !== undefined) {
                    queryParams.append('isActive', filters.isActive);
                }
                
                // Make API request
                const response = await fetch(`/api/funding?${queryParams.toString()}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch funding opportunities');
                }
                
                const opportunities = await response.json();
                
                // Update the UI with the results
                displayFundingOpportunities(opportunities);
            } catch (error) {
                console.error('Error fetching funding opportunities:', error);
                displayError('Failed to load funding opportunities. Please try again later.');
            }
        }
        
        // Function to search funding opportunities
        async function searchFunding() {
            try {
                const searchTerm = document.getElementById('search-funding').value.trim();
                
                if (!searchTerm) {
                    // If search term is empty, just fetch all opportunities
                    return fetchFundingOpportunities();
                }
                
                // Make API request to search endpoint
                const response = await fetch(`/api/funding/search?q=${encodeURIComponent(searchTerm)}`);
                
                if (!response.ok) {
                    throw new Error('Failed to search funding opportunities');
                }
                
                const opportunities = await response.json();
                
                // Update the UI with the search results
                displayFundingOpportunities(opportunities);
            } catch (error) {
                console.error('Error searching funding opportunities:', error);
                displayError('Failed to search funding opportunities. Please try again later.');
            }
        }
        
        // Function to apply filters
        function applyFilters() {
            const researchArea = document.getElementById('research-area').value;
            const funderType = document.getElementById('funder-type').value;
            const fundingAmount = document.getElementById('funding-amount').value;
            const deadline = document.getElementById('deadline').value;
            const eligibility = document.getElementById('eligibility').value;
            const sortBy = document.getElementById('sort-by').value;
            
            // Build filters object based on selected values
            const filters = {};
            
            if (researchArea) {
                filters.researchArea = researchArea;
            }
            
            if (funderType) {
                filters.funder = funderType;
            }
            
            // Handle funding amount filter
            if (fundingAmount) {
                switch (fundingAmount) {
                    case 'small':
                        filters.maxFunding = 50000;
                        break;
                    case 'medium':
                        filters.minFunding = 50000;
                        filters.maxFunding = 250000;
                        break;
                    case 'large':
                        filters.minFunding = 250000;
                        filters.maxFunding = 1000000;
                        break;
                    case 'very-large':
                        filters.minFunding = 1000000;
                        break;
                }
            }
            
            // Handle deadline filter
            if (deadline) {
                switch (deadline) {
                    case 'upcoming':
                        filters.upcoming = true;
                        break;
                    case 'urgent':
                        filters.urgent = true;
                        break;
                    case 'future':
                        filters.future = true;
                        break;
                    case 'rolling':
                        filters.rolling = true;
                        break;
                }
            }
            
            // Fetch opportunities with applied filters
            fetchFundingOpportunities(filters);
        }
        
        // Function to reset filters
        function resetFilters() {
            document.getElementById('search-funding').value = '';
            document.getElementById('research-area').selectedIndex = 0;
            document.getElementById('funder-type').selectedIndex = 0;
            document.getElementById('funding-amount').selectedIndex = 0;
            document.getElementById('deadline').selectedIndex = 0;
            document.getElementById('eligibility').selectedIndex = 0;
            document.getElementById('sort-by').selectedIndex = 0;
            
            // Fetch all opportunities without filters
            fetchFundingOpportunities();
        }
        
        // Function to display funding opportunities in the UI
        function displayFundingOpportunities(opportunities) {
            const fundingListElement = document.querySelector('.funding-list');
            const resultCountElement = document.getElementById('result-count');
            
            // Update result count
            resultCountElement.textContent = opportunities.length;
            
            // Clear current content
            fundingListElement.innerHTML = '';
            
            if (opportunities.length === 0) {
                fundingListElement.innerHTML = `
                    <div class="no-results">
                        <p>No funding opportunities found matching your criteria.</p>
                        <button class="btn btn-secondary" onclick="resetFilters()">Reset Filters</button>
                    </div>
                `;
                return;
            }
            
            // Add each opportunity to the list
            opportunities.forEach(opportunity => {
                // Format deadline
                const deadlineDate = new Date(opportunity.applicationDeadline);
                const formattedDeadline = deadlineDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                // Check if deadline is urgent (within 7 days)
                const today = new Date();
                const deadlineDays = Math.floor((deadlineDate - today) / (1000 * 60 * 60 * 24));
                const isUrgent = deadlineDays <= 7 && deadlineDays >= 0;
                
                // Format funding amount
                const minFunding = opportunity.minFunding ? `$${opportunity.minFunding.toLocaleString()}` : '';
                const maxFunding = opportunity.maxFunding ? `$${opportunity.maxFunding.toLocaleString()}` : '';
                let fundingRange = '';
                
                if (minFunding && maxFunding) {
                    fundingRange = `${minFunding} - ${maxFunding}`;
                } else if (minFunding) {
                    fundingRange = `From ${minFunding}`;
                } else if (maxFunding) {
                    fundingRange = `Up to ${maxFunding}`;
                } else {
                    fundingRange = 'Not specified';
                }
                
                // Create HTML for the opportunity
                const opportunityHTML = `
                    <div class="funding-card">
                        <div class="funding-header">
                            <div>
                                <h3 class="funding-title">${opportunity.title}</h3>
                                <p class="funding-funder">${opportunity.funder}</p>
                            </div>
                            <div class="funding-deadline ${isUrgent ? 'urgent' : ''}">Deadline: ${formattedDeadline}</div>
                        </div>
                        
                        <div class="funding-content">
                            <div class="funding-meta">
                                <div class="funding-meta-item">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>${fundingRange}</span>
                                </div>
                                <div class="funding-meta-item">
                                    <i class="fas fa-user-graduate"></i>
                                    <span>${opportunity.eligibility}</span>
                                </div>
                            </div>
                            
                            <div class="funding-description">
                                <p>${opportunity.description}</p>
                            </div>
                            
                            <div class="funding-tags">
                                ${opportunity.researchAreas.map(area => `<span class="funding-tag">${area}</span>`).join('')}
                            </div>
                            
                            <div class="funding-actions">
                                <a href="/funding-detail.html?id=${opportunity._id}" class="btn btn-primary">View Details</a>
                                <button class="btn btn-secondary" onclick="saveOpportunity('${opportunity._id}')">
                                    <i class="far fa-bookmark"></i> Save
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                fundingListElement.innerHTML += opportunityHTML;
            });
        }
        
        // Function to display error messages
        function displayError(message) {
            const fundingListElement = document.querySelector('.funding-list');
            fundingListElement.innerHTML = `
                <div class="error-message">
                    <p>${message}</p>
                    <button class="btn btn-secondary" onclick="fetchFundingOpportunities()">Try Again</button>
                </div>
            `;
        }
        
        // Function to save an opportunity (requires authentication)
        function saveOpportunity(id) {
            // For now, just change the button appearance
            const button = event.target.closest('button');
            button.innerHTML = '<i class="fas fa-bookmark"></i> Saved';
            button.disabled = true;
            
            // In a full implementation, this would connect to an API endpoint to save the opportunity
            // to the user's profile or a saved list, which would require user authentication
        }
    </script>
</body>
</html> 